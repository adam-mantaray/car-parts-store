<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>لوحة التحكم - AutoParts EG</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: { extend: {
        colors: { dark: { 1: '#1c1c1e', 2: '#2a2a2e', 3: '#333338' }, gold: { DEFAULT: '#c9a96e', light: '#d4b97e', dark: '#b8944f' }, muted: '#9a9a9e' },
        fontFamily: { cairo: ['Cairo'], inter: ['Inter'], mono: ['JetBrains Mono'] }
      }}
    }
  </script>
</head>
<body class="bg-dark-1">
  <!-- Sidebar -->
  <aside class="admin-sidebar">
    <div class="px-6 mb-8">
      <a href="../index.html" class="flex items-center gap-2">
        <i class="fa-solid fa-gear text-gold text-xl"></i>
        <span class="font-cairo text-lg font-bold">AutoParts <span class="text-gold">EG</span></span>
      </a>
    </div>
    <a href="index.html" class="active"><i class="fa-solid fa-chart-line"></i><span class="font-cairo">لوحة التحكم</span></a>
    <a href="parts.html"><i class="fa-solid fa-boxes-stacked"></i><span class="font-cairo">القطع</span></a>
    <a href="pricing.html"><i class="fa-solid fa-coins"></i><span class="font-cairo">التسعير</span></a>
    <a href="orders.html"><i class="fa-solid fa-clipboard-list"></i><span class="font-cairo">الطلبات</span></a>
    <div class="mt-auto px-6 pt-10">
      <a href="../index.html" class="!border-0"><i class="fa-solid fa-arrow-right"></i><span class="font-cairo">الموقع</span></a>
    </div>
  </aside>

  <!-- Content -->
  <div class="admin-content">
    <h1 class="font-cairo text-3xl font-bold mb-8">لوحة التحكم</h1>

    <!-- Stats -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-5 mb-10" id="statsGrid"></div>

    <!-- Chart -->
    <div class="bg-dark-2 rounded-xl p-6 border border-dark-3 mb-10">
      <h3 class="font-cairo text-xl font-bold mb-6">القطع حسب التصنيف</h3>
      <div class="bar-chart" id="barChart" style="height:200px; padding-bottom:40px;"></div>
    </div>

    <!-- Recent Orders -->
    <div class="bg-dark-2 rounded-xl p-6 border border-dark-3">
      <h3 class="font-cairo text-xl font-bold mb-6">اخر الطلبات</h3>
      <table class="table-dark">
        <thead><tr>
          <th>رقم الطلب</th><th>العميل</th><th>القطع</th><th>الاجمالي</th><th>الحالة</th><th>التاريخ</th>
        </tr></thead>
        <tbody id="ordersTable"></tbody>
      </table>
    </div>
  </div>

  <script src="../js/app.js"></script>
  <script>
    // Stats
    const inStock = PARTS.filter(p => p.inStock).length;
    const totalValue = PARTS.reduce((s,p) => s + p.priceEgp, 0);
    const stats = [
      { icon: 'fa-boxes-stacked', label: 'اجمالي القطع', value: PARTS.length },
      { icon: 'fa-layer-group', label: 'التصنيفات', value: CATEGORIES.length },
      { icon: 'fa-check-circle', label: 'متوفر', value: inStock },
      { icon: 'fa-coins', label: 'قيمة المخزون', value: fmtEGP(totalValue) },
    ];
    document.getElementById('statsGrid').innerHTML = stats.map(s => `
      <div class="stat-card">
        <div class="stat-icon"><i class="fa-solid ${s.icon}"></i></div>
        <div>
          <div class="stat-number">${s.value}</div>
          <div class="stat-label">${s.label}</div>
        </div>
      </div>`).join('');

    // Bar chart
    const catCounts = CATEGORIES.map(c => ({ name: c.nameAr, count: PARTS.filter(p => p.category === c.id).length }));
    const maxCount = Math.max(...catCounts.map(c => c.count));
    document.getElementById('barChart').innerHTML = catCounts.map(c => `
      <div class="bar" style="height:${(c.count/maxCount)*100}%">
        <div class="bar-value">${c.count}</div>
        <div class="bar-label">${c.name}</div>
      </div>`).join('');

    // Mock orders
    const mockOrders = [
      { id: 'ORD-001', customer: 'احمد محمد', items: 3, total: 45200, status: 'delivered', date: '2024-01-15' },
      { id: 'ORD-002', customer: 'محمد علي', items: 1, total: 92500, date: '2024-01-14', status: 'shipped' },
      { id: 'ORD-003', customer: 'سارة احمد', items: 2, total: 16125, date: '2024-01-14', status: 'processing' },
      { id: 'ORD-004', customer: 'عمر حسن', items: 5, total: 127650, date: '2024-01-13', status: 'pending' },
      { id: 'ORD-005', customer: 'فاطمة يوسف', items: 1, total: 26462, date: '2024-01-12', status: 'delivered' },
    ];
    const statusMap = { delivered: ['تم التوصيل','badge-success'], shipped: ['تم الشحن','badge-info'], processing: ['جاري التجهيز','badge-gold'], pending: ['في الانتظار','badge-error'] };
    document.getElementById('ordersTable').innerHTML = mockOrders.map(o => {
      const [label, cls] = statusMap[o.status];
      return `<tr>
        <td class="font-mono text-gold">${o.id}</td>
        <td class="font-cairo">${o.customer}</td>
        <td>${o.items}</td>
        <td class="price-gold text-base">${fmtEGP(o.total)}</td>
        <td><span class="badge ${cls}">${label}</span></td>
        <td class="text-muted font-inter text-sm">${o.date}</td>
      </tr>`;
    }).join('');
  </script>
</body>
</html>
