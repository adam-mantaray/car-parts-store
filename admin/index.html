<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard | AutoParts Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="../css/style.css?v=2">
  <script>tailwind.config={theme:{extend:{colors:{dark:{50:'#e8e8ef',100:'#b0b0c0',200:'#8888a0',300:'#5a5a72',400:'#3a3a4a',500:'#2a2a3a',600:'#1e1e2a',700:'#16161f',800:'#111118',900:'#0a0a0f'},accent:{DEFAULT:'#3b82f6',light:'#60a5fa',dark:'#1d4ed8'}},fontFamily:{sans:['Inter','sans-serif'],cairo:['Cairo','sans-serif']}}}}</script>
</head>
<body class="bg-dark-900 text-dark-50">

  <div class="flex min-h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-dark-800 border-r border-dark-500 flex-shrink-0 hidden lg:flex flex-col">
      <div class="p-6 border-b border-dark-500">
        <a href="../index.html" class="flex items-center gap-3">
          <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-accent to-accent-dark flex items-center justify-center">
            <i class="fa-solid fa-gear text-white"></i>
          </div>
          <div>
            <div class="font-bold text-sm">AutoParts EG</div>
            <div class="text-[10px] text-dark-400 uppercase tracking-wider">Admin Panel</div>
          </div>
        </a>
      </div>
      <nav class="flex-1 p-4 space-y-1">
        <a href="index.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg bg-accent/10 text-accent-light text-sm font-medium">
          <i class="fa-solid fa-chart-line w-5"></i> Dashboard
        </a>
        <a href="parts.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-dark-300 hover:bg-dark-700 hover:text-dark-50 transition-colors text-sm">
          <i class="fa-solid fa-boxes-stacked w-5"></i> Parts
        </a>
        <a href="pricing.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-dark-300 hover:bg-dark-700 hover:text-dark-50 transition-colors text-sm">
          <i class="fa-solid fa-coins w-5"></i> Pricing
        </a>
        <a href="orders.html" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-dark-300 hover:bg-dark-700 hover:text-dark-50 transition-colors text-sm">
          <i class="fa-solid fa-receipt w-5"></i> Orders
        </a>
      </nav>
      <div class="p-4 border-t border-dark-500">
        <a href="../index.html" class="flex items-center gap-3 px-4 py-2 text-sm text-dark-400 hover:text-dark-200 transition-colors">
          <i class="fa-solid fa-arrow-left w-5"></i> Back to Store
        </a>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 overflow-auto">
      <!-- Top Bar -->
      <header class="h-16 border-b border-dark-500 flex items-center justify-between px-8 bg-dark-800/50">
        <h1 class="text-lg font-bold">Dashboard</h1>
        <div class="flex items-center gap-4 text-sm text-dark-300">
          <span><i class="fa-solid fa-clock mr-1"></i> Last updated: just now</span>
          <div class="w-8 h-8 rounded-full bg-accent/20 flex items-center justify-center">
            <i class="fa-solid fa-user text-accent text-xs"></i>
          </div>
        </div>
      </header>

      <div class="p-8">
        <!-- Stats Grid -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
          <div class="stat-card">
            <div class="flex items-center justify-between mb-4">
              <div class="w-10 h-10 rounded-lg bg-blue-500/10 flex items-center justify-center">
                <i class="fa-solid fa-boxes-stacked text-blue-400"></i>
              </div>
              <span class="text-xs text-green-400 bg-green-500/10 px-2 py-0.5 rounded-full"><i class="fa-solid fa-arrow-up mr-1"></i>12%</span>
            </div>
            <div class="stat-value text-blue-400" id="totalParts">0</div>
            <div class="stat-label mt-1">Total Parts</div>
          </div>
          <div class="stat-card">
            <div class="flex items-center justify-between mb-4">
              <div class="w-10 h-10 rounded-lg bg-green-500/10 flex items-center justify-center">
                <i class="fa-solid fa-database text-green-400"></i>
              </div>
              <span class="text-xs text-green-400 bg-green-500/10 px-2 py-0.5 rounded-full">EPC</span>
            </div>
            <div class="stat-value text-green-400" id="scrapedParts">0</div>
            <div class="stat-label mt-1">EPC Verified</div>
          </div>
          <div class="stat-card">
            <div class="flex items-center justify-between mb-4">
              <div class="w-10 h-10 rounded-lg bg-purple-500/10 flex items-center justify-center">
                <i class="fa-solid fa-layer-group text-purple-400"></i>
              </div>
            </div>
            <div class="stat-value text-purple-400" id="totalCats">0</div>
            <div class="stat-label mt-1">Categories</div>
          </div>
          <div class="stat-card">
            <div class="flex items-center justify-between mb-4">
              <div class="w-10 h-10 rounded-lg bg-yellow-500/10 flex items-center justify-center">
                <i class="fa-solid fa-coins text-yellow-400"></i>
              </div>
            </div>
            <div class="stat-value text-yellow-400">50</div>
            <div class="stat-label mt-1">EGP/USD Rate</div>
          </div>
        </div>

        <div class="grid lg:grid-cols-2 gap-6 mb-8">
          <!-- Category Distribution -->
          <div class="card p-6">
            <h3 class="font-bold text-sm mb-6 flex items-center gap-2">
              <i class="fa-solid fa-chart-bar text-accent"></i>
              Parts by Category
            </h3>
            <div class="bar-chart" id="catChart"></div>
            <div class="flex gap-2 mt-3 overflow-x-auto text-[10px] text-dark-400" id="catChartLabels"></div>
          </div>

          <!-- Price Distribution -->
          <div class="card p-6">
            <h3 class="font-bold text-sm mb-6 flex items-center gap-2">
              <i class="fa-solid fa-chart-pie text-accent"></i>
              Price Ranges (EGP)
            </h3>
            <div class="space-y-4" id="priceRanges"></div>
          </div>
        </div>

        <!-- Recent Parts -->
        <div class="card overflow-hidden">
          <div class="p-6 border-b border-dark-500 flex items-center justify-between">
            <h3 class="font-bold text-sm flex items-center gap-2">
              <i class="fa-solid fa-clock-rotate-left text-accent"></i>
              Recently Added Parts
            </h3>
            <a href="parts.html" class="text-sm text-accent hover:text-accent-light transition-colors">View All</a>
          </div>
          <table class="data-table">
            <thead><tr><th>OEM</th><th>Name</th><th>Category</th><th>USD</th><th>EGP</th><th>Source</th></tr></thead>
            <tbody id="recentTable"></tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <script src="../js/app.js?v=2"></script>
  <script>
    // Stats
    document.getElementById('totalParts').textContent = PARTS.length;
    document.getElementById('scrapedParts').textContent = PARTS.filter(p => p.scraped).length;
    document.getElementById('totalCats').textContent = CATEGORIES.length;

    // Category bar chart
    const chartEl = document.getElementById('catChart');
    const labelsEl = document.getElementById('catChartLabels');
    const catCounts = CATEGORIES.map(c => ({ name: c.nameEn, count: PARTS.filter(p => p.category === c.id).length })).filter(c => c.count > 0);
    const maxCount = Math.max(...catCounts.map(c => c.count));
    catCounts.forEach(c => {
      const pct = (c.count / maxCount * 100);
      chartEl.innerHTML += `<div class="bar" style="height:${pct}%" title="${c.name}: ${c.count}"><span class="absolute -top-5 left-1/2 -translate-x-1/2 text-[10px] text-dark-300">${c.count}</span></div>`;
      labelsEl.innerHTML += `<span class="flex-1 text-center truncate">${c.name.split(' ')[0]}</span>`;
    });

    // Price ranges
    const ranges = [
      { label: 'Under 500 EGP', min: 0, max: 500 },
      { label: '500 - 5,000 EGP', min: 500, max: 5000 },
      { label: '5,000 - 25,000 EGP', min: 5000, max: 25000 },
      { label: '25,000 - 50,000 EGP', min: 25000, max: 50000 },
      { label: 'Over 50,000 EGP', min: 50000, max: Infinity }
    ];
    const priceEl = document.getElementById('priceRanges');
    ranges.forEach(r => {
      const count = PARTS.filter(p => p.priceEgp >= r.min && p.priceEgp < r.max).length;
      const pct = (count / PARTS.length * 100).toFixed(0);
      priceEl.innerHTML += `
        <div>
          <div class="flex justify-between text-sm mb-1">
            <span class="text-dark-200">${r.label}</span>
            <span class="text-dark-400">${count} parts (${pct}%)</span>
          </div>
          <div class="h-2 bg-dark-600 rounded-full overflow-hidden">
            <div class="h-full bg-gradient-to-r from-accent to-accent-light rounded-full transition-all duration-1000" style="width:${pct}%"></div>
          </div>
        </div>`;
    });

    // Recent parts table
    const recentEl = document.getElementById('recentTable');
    PARTS.slice(-10).reverse().forEach(p => {
      const cat = CATEGORIES.find(c => c.id === p.category);
      recentEl.innerHTML += `
        <tr>
          <td><span class="oem-badge">${p.oem}</span></td>
          <td>${p.nameEn}</td>
          <td class="text-dark-300 text-xs">${cat ? cat.nameEn : ''}</td>
          <td class="text-dark-300">${fmtUSD(p.priceUsd)}</td>
          <td class="font-semibold">${fmtEGP(p.priceEgp)}</td>
          <td>${p.scraped ? '<span class="text-green-400 text-xs"><i class="fa-solid fa-check-circle mr-1"></i>EPC</span>' : '<span class="text-dark-400 text-xs">OEM Ref</span>'}</td>
        </tr>`;
    });
  </script>
</body>
</html>
