<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ادارة القطع - AutoParts EG</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: { extend: {
        colors: { dark: { 1: '#1c1c1e', 2: '#2a2a2e', 3: '#333338' }, gold: { DEFAULT: '#c9a96e', light: '#d4b97e', dark: '#b8944f' }, muted: '#9a9a9e' },
        fontFamily: { cairo: ['Cairo'], inter: ['Inter'], mono: ['JetBrains Mono'] }
      }}
    }
  </script>
</head>
<body class="bg-dark-1">
  <aside class="admin-sidebar">
    <div class="px-6 mb-8">
      <a href="../index.html" class="flex items-center gap-2">
        <i class="fa-solid fa-gear text-gold text-xl"></i>
        <span class="font-cairo text-lg font-bold">AutoParts <span class="text-gold">EG</span></span>
      </a>
    </div>
    <a href="index.html"><i class="fa-solid fa-chart-line"></i><span class="font-cairo">لوحة التحكم</span></a>
    <a href="parts.html" class="active"><i class="fa-solid fa-boxes-stacked"></i><span class="font-cairo">القطع</span></a>
    <a href="pricing.html"><i class="fa-solid fa-coins"></i><span class="font-cairo">التسعير</span></a>
    <a href="orders.html"><i class="fa-solid fa-clipboard-list"></i><span class="font-cairo">الطلبات</span></a>
  </aside>

  <div class="admin-content">
    <div class="flex items-center justify-between mb-8">
      <h1 class="font-cairo text-3xl font-bold">ادارة القطع</h1>
      <button onclick="openModal()" class="btn-gold"><i class="fa-solid fa-plus ml-2"></i>اضافة قطعة</button>
    </div>

    <!-- Search -->
    <div class="mb-6">
      <input type="text" id="searchParts" placeholder="ابحث بالاسم، رقم OEM..." class="input-dark font-cairo max-w-md">
    </div>

    <!-- Table -->
    <div class="bg-dark-2 rounded-xl border border-dark-3 overflow-x-auto">
      <table class="table-dark">
        <thead><tr>
          <th>#</th><th>OEM</th><th>الاسم (عربي)</th><th>الاسم (انجليزي)</th><th>التصنيف</th><th>USD</th><th>EGP</th><th>الحالة</th><th></th>
        </tr></thead>
        <tbody id="partsTable"></tbody>
      </table>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal-overlay" id="partModal">
    <div class="modal-content">
      <div class="flex items-center justify-between mb-6">
        <h3 class="font-cairo text-xl font-bold" id="modalTitle">اضافة قطعة</h3>
        <button onclick="closeModal()" class="text-muted hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
      </div>
      <div class="space-y-4">
        <input type="text" placeholder="رقم OEM" class="input-dark font-mono" id="mOem">
        <input type="text" placeholder="الاسم بالعربي" class="input-dark font-cairo" id="mNameAr">
        <input type="text" placeholder="Name in English" class="input-dark font-inter" id="mNameEn">
        <select class="input-dark font-cairo" id="mCategory">
          <option value="">التصنيف</option>
        </select>
        <input type="number" placeholder="السعر USD" class="input-dark font-inter" id="mPrice" step="0.01">
        <input type="text" placeholder="سنوات التوافق" class="input-dark font-inter" id="mYears" value="2014-2021">
      </div>
      <button onclick="saveModal()" class="btn-gold w-full mt-6">حفظ</button>
    </div>
  </div>

  <script src="../js/app.js"></script>
  <script>
    // Fill category select
    const mCat = document.getElementById('mCategory');
    CATEGORIES.forEach(c => mCat.innerHTML += `<option value="${c.id}">${c.nameAr} - ${c.nameEn}</option>`);

    function renderTable() {
      const q = document.getElementById('searchParts').value.toLowerCase();
      const filtered = PARTS.filter(p => !q || p.nameAr.includes(q) || p.nameEn.toLowerCase().includes(q) || p.oem.toLowerCase().includes(q));
      document.getElementById('partsTable').innerHTML = filtered.map(p => {
        const cat = CATEGORIES.find(c => c.id === p.category);
        return `<tr>
          <td class="text-muted">${p.id}</td>
          <td class="font-mono text-gold text-xs">${p.oem}</td>
          <td class="font-cairo">${p.nameAr}</td>
          <td class="font-inter text-muted text-sm">${p.nameEn}</td>
          <td class="font-cairo text-sm">${cat?.nameAr || ''}</td>
          <td class="font-inter text-sm">${fmtUSD(p.priceUsd)}</td>
          <td class="price-gold text-base">${fmtEGP(p.priceEgp)}</td>
          <td>${p.inStock ? '<span class="badge badge-success">متوفر</span>' : '<span class="badge badge-error">نفذ</span>'}</td>
          <td><button onclick="editPart(${p.id})" class="text-gold hover:text-gold-light"><i class="fa-solid fa-pen"></i></button></td>
        </tr>`;
      }).join('');
    }

    document.getElementById('searchParts').addEventListener('input', renderTable);
    renderTable();

    function openModal() { document.getElementById('partModal').classList.add('show'); document.getElementById('modalTitle').textContent = 'اضافة قطعة'; }
    function closeModal() { document.getElementById('partModal').classList.remove('show'); }
    function editPart(id) {
      const p = PARTS.find(x => x.id === id);
      if (!p) return;
      document.getElementById('mOem').value = p.oem;
      document.getElementById('mNameAr').value = p.nameAr;
      document.getElementById('mNameEn').value = p.nameEn;
      document.getElementById('mCategory').value = p.category;
      document.getElementById('mPrice').value = p.priceUsd;
      document.getElementById('mYears').value = p.years;
      document.getElementById('modalTitle').textContent = 'تعديل قطعة #' + id;
      openModal();
    }
    function saveModal() { showToast('تم الحفظ'); closeModal(); }
  </script>
</body>
</html>
