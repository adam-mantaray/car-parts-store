<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>الطلبات - AutoParts EG</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: { extend: {
        colors: { dark: { 1: '#1c1c1e', 2: '#2a2a2e', 3: '#333338' }, gold: { DEFAULT: '#c9a96e', light: '#d4b97e', dark: '#b8944f' }, muted: '#9a9a9e' },
        fontFamily: { cairo: ['Cairo'], inter: ['Inter'], mono: ['JetBrains Mono'] }
      }}
    }
  </script>
</head>
<body class="bg-dark-1">
  <aside class="admin-sidebar">
    <div class="px-6 mb-8">
      <a href="../index.html" class="flex items-center gap-2">
        <i class="fa-solid fa-gear text-gold text-xl"></i>
        <span class="font-cairo text-lg font-bold">AutoParts <span class="text-gold">EG</span></span>
      </a>
    </div>
    <a href="index.html"><i class="fa-solid fa-chart-line"></i><span class="font-cairo">لوحة التحكم</span></a>
    <a href="parts.html"><i class="fa-solid fa-boxes-stacked"></i><span class="font-cairo">القطع</span></a>
    <a href="pricing.html"><i class="fa-solid fa-coins"></i><span class="font-cairo">التسعير</span></a>
    <a href="orders.html" class="active"><i class="fa-solid fa-clipboard-list"></i><span class="font-cairo">الطلبات</span></a>
  </aside>

  <div class="admin-content">
    <h1 class="font-cairo text-3xl font-bold mb-8">ادارة الطلبات</h1>

    <!-- Stats -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
      <div class="stat-card"><div class="stat-icon"><i class="fa-solid fa-clipboard-list"></i></div><div><div class="stat-number">12</div><div class="stat-label">اجمالي الطلبات</div></div></div>
      <div class="stat-card"><div class="stat-icon" style="background:rgba(74,222,128,0.12);color:#4ade80"><i class="fa-solid fa-check-circle"></i></div><div><div class="stat-number">7</div><div class="stat-label">تم التوصيل</div></div></div>
      <div class="stat-card"><div class="stat-icon" style="background:rgba(96,165,250,0.12);color:#60a5fa"><i class="fa-solid fa-truck"></i></div><div><div class="stat-number">3</div><div class="stat-label">تم الشحن</div></div></div>
      <div class="stat-card"><div class="stat-icon" style="background:rgba(239,68,68,0.12);color:#ef4444"><i class="fa-solid fa-clock"></i></div><div><div class="stat-number">2</div><div class="stat-label">في الانتظار</div></div></div>
    </div>

    <!-- Orders -->
    <div class="bg-dark-2 rounded-xl border border-dark-3 overflow-hidden">
      <table class="table-dark">
        <thead><tr>
          <th>رقم الطلب</th><th>العميل</th><th>الموبايل</th><th>المحافظة</th><th>القطع</th><th>الاجمالي</th><th>الحالة</th><th>التاريخ</th>
        </tr></thead>
        <tbody id="ordersBody"></tbody>
      </table>
    </div>
  </div>

  <script src="../js/app.js"></script>
  <script>
    const orders = [
      { id:'ORD-001', customer:'احمد محمد', phone:'01012345678', city:'القاهرة', items:3, total:45200, status:'delivered', date:'2024-01-15', parts:[9,15,70] },
      { id:'ORD-002', customer:'محمد علي', phone:'01098765432', city:'الجيزة', items:1, total:92500, status:'shipped', date:'2024-01-14', parts:[33] },
      { id:'ORD-003', customer:'سارة احمد', phone:'01123456789', city:'الاسكندرية', items:2, total:16125, status:'processing', date:'2024-01-14', parts:[26,28] },
      { id:'ORD-004', customer:'عمر حسن', phone:'01234567890', city:'الشرقية', items:5, total:127650, status:'pending', date:'2024-01-13', parts:[31,32,51,70,71] },
      { id:'ORD-005', customer:'فاطمة يوسف', phone:'01156789012', city:'المنصورة', items:1, total:26462, status:'delivered', date:'2024-01-12', parts:[9] },
      { id:'ORD-006', customer:'كريم ابراهيم', phone:'01067891234', city:'الاسماعيلية', items:2, total:17250, status:'delivered', date:'2024-01-11', parts:[46,50] },
      { id:'ORD-007', customer:'نور الدين', phone:'01178901234', city:'بورسعيد', items:1, total:22250, status:'shipped', date:'2024-01-10', parts:[41] },
      { id:'ORD-008', customer:'ياسمين خالد', phone:'01289012345', city:'السويس', items:3, total:9750, status:'delivered', date:'2024-01-09', parts:[70,71,15] },
      { id:'ORD-009', customer:'حسام الدين', phone:'01045678901', city:'اسيوط', items:2, total:41000, status:'shipped', date:'2024-01-08', parts:[60,62] },
      { id:'ORD-010', customer:'منى سعيد', phone:'01156780123', city:'سوهاج', items:1, total:6250, status:'delivered', date:'2024-01-07', parts:[72] },
      { id:'ORD-011', customer:'عبدالله محمود', phone:'01267891234', city:'قنا', items:2, total:34700, status:'delivered', date:'2024-01-06', parts:[47,48] },
      { id:'ORD-012', customer:'ريم عادل', phone:'01078912345', city:'الفيوم', items:1, total:19250, status:'pending', date:'2024-01-05', parts:[53] },
    ];

    const statusMap = {
      delivered: { label: 'تم التوصيل', cls: 'badge-success' },
      shipped: { label: 'تم الشحن', cls: 'badge-info' },
      processing: { label: 'جاري التجهيز', cls: 'badge-gold' },
      pending: { label: 'في الانتظار', cls: 'badge-error' }
    };
    const statusOptions = ['pending','processing','shipped','delivered'];

    function renderOrders() {
      document.getElementById('ordersBody').innerHTML = orders.map((o, i) => {
        const s = statusMap[o.status];
        const partNames = o.parts.map(pid => PARTS.find(p=>p.id===pid)?.nameAr || '').join('، ');
        return `<tr>
          <td>
            <button onclick="toggleDetail(${i})" class="font-mono text-gold hover:underline">${o.id}</button>
          </td>
          <td class="font-cairo">${o.customer}</td>
          <td class="font-inter text-sm text-muted">${o.phone}</td>
          <td class="font-cairo text-sm">${o.city}</td>
          <td class="text-center">${o.items}</td>
          <td class="price-gold text-base">${fmtEGP(o.total)}</td>
          <td>
            <select onchange="changeStatus(${i}, this.value)" class="input-dark py-1 px-2 text-xs font-cairo w-28">
              ${statusOptions.map(st => `<option value="${st}" ${o.status===st?'selected':''}>${statusMap[st].label}</option>`).join('')}
            </select>
          </td>
          <td class="text-muted font-inter text-sm">${o.date}</td>
        </tr>
        <tr id="detail-${i}" style="display:none">
          <td colspan="8" class="bg-dark-1 p-4">
            <p class="font-cairo text-sm text-muted mb-1">القطع:</p>
            <p class="font-cairo text-sm">${partNames}</p>
          </td>
        </tr>`;
      }).join('');
    }

    function toggleDetail(i) {
      const row = document.getElementById('detail-' + i);
      row.style.display = row.style.display === 'none' ? 'table-row' : 'none';
    }

    function changeStatus(i, status) {
      orders[i].status = status;
      showToast('تم تحديث حالة الطلب');
    }

    renderOrders();
  </script>
</body>
</html>
